# 阈值签名

什么是阈值签名？简而言之，阈值签名方案是一种用多方之间的交互协议代替数字签名方案的方法，其中包括密钥生成和签名算法两部分。 密钥生成协议涉及一组 n 方，它们以交互方式生成密钥的 m-out-of-n 秘密共享。与标准的秘密共享不同，这不是通过在本地生成密钥并在各方之间共享来实现的。相反，密钥是以共享方式直接生成的，因此少于 m 方的子集不会有关于密钥的任何信息。接下来，将签名算法替换为交互协议以生成签名。假设有一组节点共n个，阈值为t，那么必须至少有t个节点交互进行签名才能生成一份有效的签名。

## 安全的阈值签名

由于少于m个节点的子集不能产生一个可用的签名，因此如果一个节点同意在向某个实体转移一笔钱上签字，那么即使有些参与者是恶意的，他们也不能转移不同的钱，或转移给其他人，或在之后产生额外的转移。只有超过阈值数的节点同意的交易才能正常执行。阈值签名也为定义可签名人员提供了灵活性，这意味着有可能为不同的金额设置不同的合法签名人数。例如，可以为保护较小金额资金的设置小的人数（去中心化程度更低、签名更快、低安全），为保护大金额的设置大的人数（去中心化程度更高、签名稍满、高安全）。

## 主动刷新共享秘密

在阈值签名方案中，每一方都会持有一份私钥的份额，而任何满足阈值的人数都可以产生签名，因此，任何有权参与签名的多方可以组合定义私钥，在这之中可以存在一方将会慢慢的贿赂联合持有份额的各方，随着时间的推移，该方可能会窃取到足够的份额来重构私钥。刷新的目的就是为了实现主动的安全，这意味着对手必须同时破解足够的份额，才能获取到信息。具体到实施，可以设置一个固定的时间间隔，对手必须在这个时间间隔内破解达到阈值的份额，否则将会一无所获，这种在一个固定时间内破解固定数量密钥的难度要比在一段时间破解固定数量密钥的大的多，特别是当时间趋向比较小的范围，破解几乎是不可能的。

现在，来简单看看如何进行刷新。这实际上是很简单的。首先，私钥 k 的 m-out-of-n 秘密共享是通过定义随机次数为- (m-1) 的多项式 f 生成的，使得 f(0) = k，并且第 i 方（for i = 1,…,n) 接收份额 f(i)。 (m-1)阶多项式上的任何 m 个点都足以重建多项式，从而重建秘密。这意味着，如果各方在一段时间内持有相同的份额，那么攻击者慢慢地窃取一个又一个份额，就能获得秘密。为了防止这种情况，我们希望各方在每个间隔期结束时用一个新的多项式来生成同一个秘密的新共享，这样以前的共享就没有用了（因为以前的共享属于不同的多项式，在这个操作之后它们就没有意义了）。不需要详细说明如何生成，用不同的多项式生成这个新共享的最优雅的方法是当事人共同生成一个随机次数-(m-1)多项式 g 的共享，使得 g (0) = 0。然后，给定 g (i)和 f (i) ，第 i 方局部地计算它的新共享为 f’(i) = f (i) + g (i)。

## 动态阈值签名

阈值签名是一个非常好的方案，但是在实践时我们需要考虑更多的情况。比如，在阈值签名组中可能会有人退出或是加入了新的人员，这应该是一个很正常的情况，这也是一个必要的功能，否则每次签名组中有人变动就要将加密货币转移到新的地址中，这种操作太蠢了，显然是不可行的。当然，要实现动态分配份额也很简单，只需要向签名组中的人提供他们的份额f(j),其中j表示他们的身份（或ID），然后通过就可以通过上述的刷新操作来轻松实现，在这个操作后，先前的份额就失效了，与此同时就会重新分配份额，实现动态阈值签名。

## 多重签名与阈值签名

多重签名，在加密货币中，本质上就是由多个签名组成的签名，这些签名是根据一个给定的签名人数进行验证的。例如，2-out-of-3的多重签名就是用三个公钥定义的，验证脚本将用这三个公钥中的两个来验证在它们在同一个消息上的两个签名是否是有效的。从技术上看，多重签名其实就是阈值签名的反向，为什么这么说呢？先看阈值签名，在阈值签名中，密钥生成和签名的程序是被修改了的，但是验证的程序是不变的。反之，在多重签名中，密钥生成和签名的程序是一样的，但是验证签名的程序会被修改，以便能验证多个签名。从这个角度上看，多重签名和阈值签名只是实现同一目标的不同手段，即必须要有一定的人数才能生成有效的签名，并且需要每次生成。当然，他们还是有很多不同之处的：

1.复杂程度：在密码学中，多重签名比阈值签名简单的多，特别是多重签名在密钥生成和签名上都没有太大的更改，唯一要注意的就是需要少量的代码来验证多个签名和检查是否满足一定人数，而阈值签名方案是更高级的加密协议，需要足够的专业知识才能设计和部署。

2.多重签名支持。阈值签名方案生成的标准签名与普通生成的签名相同，对于区块链来说，甚至不知道签名是以特殊方式生成的。相反，多签名需要以不同的方式进行验证，因此它们必须得到平台的具体支持，因为并非所有加密货币都支持多重签名，这可能是一个问题。此外，多重签名有更高的成本，参与签名的人越多费用会越高。

3.主动刷新。阈值签名支持刷新共享，以防止份额逐渐被盗。多重签名不支持这一点，因为每个密钥都是完整持有的，在不转移资金的情况下不能改变。因此，对于攻击者在很长一段时间内缓慢地窃取每个密钥，没有任何缓解措施。

4.动态阈值。同样，阈值签名支持删除和添加持有密钥份额。相比之下，多重签名不支持这个。如果我们想把一个法定人数从2-3人修改为2-4人（因为一个新的签名人员加入了这个团体），那么在使用多重签名时，我们必须把资金转移到新的结构中。同样地，删除一个雇员并将签名人数从2-out-of-4改为2-out-of-3，也需要转移资金。最后，用另一个人员替换其中一个也需要改变密钥，从而转移资金，否则，以前的人员仍然有权利进行签名。

## 总结

总的来说，虽然阈值签名和多重签名解决了同样的基本问题，但阈值签名比多重签名有许多优势。多重签名的主要优势就是它非常简单，不需要任何特殊的密码学专业知识来构建和部署。