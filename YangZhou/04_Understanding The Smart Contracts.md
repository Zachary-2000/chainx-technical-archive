# Understanding The Smart Contracts

## Preface

The concept of smart contract was first proposed by Nick Szabo in 1994. It is a computer protocol designed to disseminate, verify and execute contracts in an information-based manner. However, due to the lack of a trusted execution environment, smart contract has not been applied to the actual industry. Since the birth of bitcoin, People realize that the underlying technology of bitcoin - blockchain can naturally provide a trusted execution environment for smart contracts. Ethereum first saw the fit between blockchain and smart contracts, released the white paper *A Next-Generation Smart Contract and Decentralized Application Platform*, and has been committed to building Ethereum into the best smart contract platform.

## Smart Contract

Smart contract is a computer program that can be automatically executed when certain conditions are met. This program is like a person who can always be trusted. It can keep assets and always operate according to the pre-determined rules.

The following diagram is a smart contract model: a piece of smart contract code is deployed on the distributed ledger, which can respond to the received external information.

![img](https://github.com/helloyzp/BlockChainArticles/blob/master/images/smart_contarct_model.png)



The existence of smart contract makes it no longer necessary for intermediaries to complete transactions, so there is no need to pay the cost of intermediaries, which saves people's time, costs and avoids conflicts.

For better understanding, for example: suppose John wants to buy Bob's house, the agreement will be reached on the blockchain using a smart contract, which contains the agreement between John and Bob. In short, the contract is as follows: "Bob will acquire ownership of the house when Bob pays John 150 eth".

![smart_contract](https://github.com/helloyzp/BlockChainArticles/blob/master/images/smart_contract.png)

In this case, if the smart contract is not used, Bob and John will have to pay a lot of fees to the third-party institutions, including banks, lawyers and housing brokers. However,  use the smart contracts, the transaction can be completed at almost little cost.

Here is a brief understanding of how smart contracts are created, compiled, deployed and executed from the perspective of developers.

## Contract Compilation

![img](https://github.com/helloyzp/BlockChainArticles/blob/master/images/smart_contract_1.webp)

As shown in the figure above, the contract file Helloworld.sol is compiled by the compiler to generate Helloworld.abi and Helloworld.bin files.

The bin file is a binary file, which is a collection of EVM instructions.

The abi file is the interface description file of the contract. The description information includes field name, field type, method name, parameter name, parameter type, method return value type, etc. abi is actually equivalent to the developer's interface document, which is convenient for the developer to call and execute the contract.

## Contract Deployment



![img](https://github.com/helloyzp/BlockChainArticles/blob/master/images/smart_contract_2.webp)



As shown in the figure above, the deployment contract sends a transaction, that is, the sendTransaction function is called. From is the account address of the publisher, to is 0, and data is the EVM operation bytecode of the contract. A smart contract address is generated when the miner packs. The smart contract address is generated by  the creator's account and  a random number according to the number of transactions sent. A new address is created as the contract account through keccak-256 encryption algorithm:

```undefined
contract address = keccak256(rlp([sender, nonce]))
```

Finally, the contract code corresponding to the contract address will be saved in the blockchain. The caller only needs to have the contract address and ABI file to call the contract code.

## Contract Call



![img](https://github.com/helloyzp/BlockChainArticles/blob/master/images/smart_contract_3.webp)



Calling the contract requires the address of the contract and the called method. The blockchain itself cannot execute the code, so it is necessary to load the contract code into the virtual machine for execution according to the contract address, and then broadcast the execution results to the blockchain database.

## Summary and Prospect

Based on the distributed architecture and consensus algorithm of blockchain, smart contracts allow users who do not trust each other to complete transactions without any trusted third-party intermediary or authority. At the same time, smart contracts in digital form can be flexibly embedded in various tangible or intangible assets, transactions and data to realize active or passive asset and information management and control, gradually build programmable intelligent assets and systems, and finally realize a programmable society.

