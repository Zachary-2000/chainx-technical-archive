# MuSig-DN

## Introduction

​	The multi-signature scheme allows a group of signers (each with their own key pair) to collaborate to calculate the signature of a public message. MuSig (also called MuSig1), MuSig2, MuSig-DN are in the same line, and they all describe a multi-signature solution. MuSig requires three rounds of communication to complete a multi-signature. MuSig2 eliminates a round of communication on the basis of MuSig and allows the use of a multi-signature process similar to our current script-based process. But MuSig2 stores additional data and needs to be very careful to ensure that the signing software or hardware will not be tricked into unknowingly repeating part of the signing session. MuSig-DN uses a combination of zero-knowledge proof and Purify (an effective deterministic random number derivation function) to protect users from key leakage attacks caused by bad random number generators and virtual machine reset attacks. At the same time, MuSig-DN is not vulnerable to repeated session attacks.

# Randomness and Determinism

​	Every Schnorr or ECDSA signature requires a nonce, which is a secret random number generated by the signer. The security of these signature schemes relies to a large extent on the uniform random generation of such random numbers. Even a slight deviation in the randomness may make it possible for an attacker to extract the key from the signature. A simple and extreme example of bad randomness is the reuse of random numbers for different messages. If two different messages are signed with the same key and exactly the same random number, the key can be calculated from the two signatures immediately.
​	In order to avoid this vulnerability in the signing process, deterministic random numbers are usually used. For example, a hash function is used as a random number `SHA256(sk, m)`, where sk is the signer’s key and m is the sign to be signed. information. Since the attacker does not know sk, the random number generated is still unpredictable, even if it is actually derived from deterministic calculations rather than true randomness. Since m is part of the input of the hash function, the signatures of different messages will use different random numbers, which excludes the reuse of random numbers for different messages. Deterministic random numbers can also prevent rollback attacks, in which attackers try to obtain signatures with the same random number on two different messages by resetting the signature algorithm.
​	Because of these advantages, it is easy to use deterministic random numbers when generating signatures, and in fact all serious implementations of signatures rely on some method to deterministically derive random numbers. However, when it comes to multi-signature, naive use of deterministic random numbers does not prevent the key from being exposed. Surprisingly, the opposite is true for MuSig implementations with deterministic random numbers that are more likely to expose the key. The working principle of the attack is as follows: The malicious signer and the victim sign the same message for two signing sessions. Since the message is the same in the two sessions, the victim deterministically generates exactly the same random number. But nothing in MuSig will force another malicious signer to deterministically generate his random number. The malicious signer can use any random number. Therefore, the "aggregated random numbers" (calculated based on the random numbers of all signers) in the two signing sessions will be different. In the end, having different aggregate nonce has the same effect as having different messages, and the attacker can easily extract the victim's key from the two signing sessions.

## Musig-DN

​	MuSig-DN is a multi-signature scheme that overcomes the above-mentioned difficulties and uses deterministic random numbers safely in MuSig. The main idea behind MuSig-DN is to use zero-knowledge proofs to force all signers to generate their random numbers deterministically. Each signer derives a deterministic random number from an additional secret key (here called a nonce key), the message, and the public keys of all signers. Then, the signers communicate their public random number in the first round of MuSig-DN and a non-interactive zero-knowledge proof that proves that their public random number has been correctly derived. All other signers can use the additional public key (here called the host key) associated with the signer's nonce key to check these proofs. If any signer tries to cheat by sending two different random numbers in different signing sessions, other signers will detect it (because at least one of the two random numbers will have an invalid zero-knowledge proof) and simply Discontinue the agreement.
​	In addition, another major contribution of MuSig-DN is Purify, which is a specific function used to derive random numbers. In contrast to hash functions such as SHA256, it is a typical choice for deriving deterministic random numbers. Purify relies on elliptic curves to extract seemingly random random numbers, and can be effectively used with the zero-knowledge proof framework.
​	A very good additional property of MuSig-DN is: similar to MuSig2, the signature session only needs two rounds of communication to complete.

## Musig Compare

![Musig-DN](https://github.com/AAweidai/PictureBed/blob/master/taproot/Musig-DN.png?raw=1)

​	The above figure shows a simple comparison of the multi-signature schemes of the Musig series. From the picture above, there is no reason to like MuSig1 more than MuSig2. Compared with MuSig2, the advantage of MuSig-DN is that it supports deterministic random numbers, which avoids the need to maintain state between signed sessions and rounds, and reduces repeated session attacks. However, the disadvantage of MuSig-DN is that it does not support non-interactive signatures, and its implementation complexity and computational complexity are extremely high.

# Conclusion

​	In general, MuSig-DN is a deterministic random number multi-signature scheme realized through the combination of zero-knowledge proof and Purify. MuSig-DN avoids the need to maintain state between signing sessions and rounds, thereby effectively reducing repeated session attacks.